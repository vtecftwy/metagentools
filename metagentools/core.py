# AUTOGENERATED! DO NOT EDIT! File to edit: ../nbs-dev/00_core.ipynb.

# %% auto 0
__all__ = ['TextFileBaseIterator', 'FastaFileIterator']

# %% ../nbs-dev/00_core.ipynb 4
import json
import re
from ecutilities.core import validate_path, validate_type
from pathlib import Path
from typing import Any, Optional

# %% ../nbs-dev/00_core.ipynb 6
class TextFileBaseIterator:
    """Iterator going through a text file by chunks of `nb_lines` lines"""
    def __init__(
        self, 
        path:str|Path,  # path to the file to read 
        nb_lines:int=1, # number of text lines in each text chunk 
    ):
        validate_path(path, raise_error=True)
        self.fp = open(path, 'r')
        self.nb_lines = nb_lines

    def __iter__(self):
        return self

    def _safe_readline(self):
        """Read a new line and handle end of file tasks"""
        line = self.fp.readline()
        if line == '':
            self.fp.close()
            raise StopIteration()
        return line

    def __next__(self):
        """Return one chunk at the time"""
        lines = []
        for i in range(self.nb_lines):
            lines.append(self._safe_readline())
        return ''.join(lines)
    
    def print_first_chuncks(self, nb_chunks=3):
        """Print the first few chuncks of text from the file"""
        for i, chunk in enumerate(self.__iter__()):
            if i > nb_chunks-1: break
            print(f"{self.nb_lines}-line chunk {i+1}")
            print(chunk)
        

# %% ../nbs-dev/00_core.ipynb 10
class FastaFileIterator(TextFileBaseIterator):
    def __next__(self):
        """Return one definition line and the corresponding sequence"""
        lines = []
        for i in range(2):
            lines.append(self._safe_readline())
        return {'definition line':lines[0], 'sequence':f"{lines[1]}"}
    def print_first_chuncks(self, nb_chunks=3):
        """Print the first few chuncks of text from the file"""
        for i, seq_dict in enumerate(self.__iter__()):
            print(f"\nSequence {i+1}:")
            print(seq_dict['definition line'])
            print(f"{seq_dict['sequence'][:80]} ...")
            if i >= nb_chunks: break
